<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ReputAí - Avaliações Reais de Empresas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Avaliações reais de empresas brasileiras. Encontre o melhor lugar para trabalhar baseado em experiências reais de funcionários.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="global-loading">
        <div class="loading-spinner"></div>
        <h2>ReputAí</h2>
        <p>Carregando a melhor experiência para você...</p>
    </div>

    <header id="main-header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <div class="logo-icon">R</div>
                    <div class="logo-text">
                        <h1>ReputAí</h1>
                        <span>Avaliações reais de empresas</span>
                    </div>
                </a>
                
                <nav>
                    <ul>
                        <li><a href="index.html" class="active"><i class="fas fa-home"></i> <span class="nav-text">Início</span></a></li>
                        <li><a href="mapa.html"><i class="fas fa-map"></i> <span class="nav-text">Mapa</span></a></li>
                        <li><a href="empresas.html"><i class="fas fa-building"></i> <span class="nav-text">Empresas</span></a></li>
                        <li><a href="avaliacao.html"><i class="fas fa-star"></i> <span class="nav-text">Avaliar</span></a></li>
                        <li id="auth-nav-item">
                            <div class="user-menu-container">
                                <div class="user-avatar" id="user-avatar" style="display: none;" onclick="toggleUserMenu()"></div>
                                <div class="user-menu" id="user-menu" style="display: none;">
                                    <a href="perfil.html"><i class="fas fa-user"></i> Meu Perfil</a>
                                    <a href="admin.html" id="admin-link" style="display: none;"><i class="fas fa-crown"></i> Painel Admin</a>
                                    <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</a>
                                </div>
                            </div>
                            <a href="#" class="nav-btn" id="login-btn" onclick="showAuthModal(); return false;">
                                <i class="fas fa-user"></i> <span class="nav-text">Entrar</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h2>
                        Encontre <span class="typing-container"><span class="typing-text"></span></span> para trabalhar
                    </h2>
                    <p>Avaliações reais de ex-funcionários para você tomar a decisão certa na sua carreira. Descubra a verdade sobre empresas brasileiras.</p>
                    
                    <div class="search-card">
                        <input type="text" id="search-company" placeholder="Digite o nome da empresa, setor ou localização...">
                        <button class="btn-search" onclick="searchCompanies()">
                            <i class="fas fa-search"></i> Buscar Empresas
                        </button>
                    </div>
                    
                    <div class="filter-tags">
                        <span class="filter-tag" onclick="filterBySector('Tecnologia')">
                            <i class="fas fa-laptop-code"></i> Tecnologia
                        </span>
                        <span class="filter-tag" onclick="filterBySector('Finanças')">
                            <i class="fas fa-chart-line"></i> Finanças
                        </span>
                        <span class="filter-tag" onclick="filterBySector('Saúde')">
                            <i class="fas fa-heartbeat"></i> Saúde
                        </span>
                        <span class="filter-tag" onclick="filterBySector('Educação')">
                            <i class="fas fa-graduation-cap"></i> Educação
                        </span>
                        <span class="filter-tag" onclick="filterBySector('Varejo')">
                            <i class="fas fa-shopping-cart"></i> Varejo
                        </span>
                    </div>
                    
                    <div class="hero-buttons">
                        <a href="mapa.html" class="btn btn-primary">
                            <i class="fas fa-map"></i> Explorar Mapa Interativo
                        </a>
                        <a href="avaliacao.html" class="btn btn-secondary">
                            <i class="fas fa-star"></i> Compartilhar Sua Experiência
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="companies-section">
        <div class="container">
            <div class="section-header">
                <h2><i class="fas fa-building"></i> Empresas em Destaque</h2>
                <p>Conheça empresas bem avaliadas por funcionários</p>
            </div>
            
            <div id="companies-list" class="companies-grid"></div>
            
            <div style="text-align: center; margin-top: 3rem;">
                <a href="empresas.html" class="btn btn-primary">
                    <i class="fas fa-list"></i> Ver Todas as Empresas
                </a>
            </div>
        </div>
    </section>

    <section class="como-funciona-section" id="como-funciona">
        <div class="container">
            <div class="section-header">
                <h2><i class="fas fa-cogs"></i> Como Funciona</h2>
                <p>Entenda em 3 passos simples como o ReputAí funciona</p>
            </div>
            
            <div class="passos-container">
                <div class="passo-card">
                    <div class="passo-numero">1</div>
                    <div class="passo-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <h3>Crie sua Conta</h3>
                    <p>Faça login ou cadastre-se gratuitamente para acessar todas as funcionalidades do sistema.</p>
                    <ul class="passo-lista">
                        <li><i class="fas fa-check-circle"></i> Cadastro rápido e seguro</li>
                        <li><i class="fas fa-check-circle"></i> Dados protegidos</li>
                        <li><i class="fas fa-check-circle"></i> Acesso imediato</li>
                    </ul>
                </div>
                
                <div class="passo-card">
                    <div class="passo-numero">2</div>
                    <div class="passo-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3>Avalie Empresas</h3>
                    <p>Compartilhe sua experiência real de trabalho em empresas brasileiras.</p>
                    <ul class="passo-lista">
                        <li><i class="fas fa-check-circle"></i> Baseado em experiência real</li>
                        <li><i class="fas fa-check-circle"></i> Sistema de 1-5 estrelas</li>
                        <li><i class="fas fa-check-circle"></i> Comentários detalhados</li>
                    </ul>
                </div>
                
                <div class="passo-card">
                    <div class="passo-numero">3</div>
                    <div class="passo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Consulte Avaliações</h3>
                    <p>Encontre as melhores empresas para trabalhar baseado em avaliações reais.</p>
                    <ul class="passo-lista">
                        <li><i class="fas fa-check-circle"></i> Mapa interativo</li>
                        <li><i class="fas fa-check-circle"></i> Filtros por setor</li>
                        <li><i class="fas fa-check-circle"></i> Busca inteligente</li>
                    </ul>
                </div>
            </div>

            <!-- Aqui começa a integração Firebase/Firestore para empresas e avaliações -->
            <script type="module">
                import { auth, db, onAuthStateChanged } from './firebase-config.js';
                import { getDocs, collection, query, where, orderBy, doc, getDoc } from 'firebase/firestore';

                async function loadFeaturedCompanies() {
                    const listContainer = document.getElementById('companies-list');
                    listContainer.innerHTML = '';

                    try {
                        const companiesRef = collection(db, 'empresas');
                        const q = query(companiesRef, orderBy('media', 'desc'), where('destaque', '==', true));
                        const snapshot = await getDocs(q);

                        if (!snapshot.empty) {
                            snapshot.forEach(docSnap => {
                                const data = docSnap.data();
                                const companyCard = document.createElement('div');
                                companyCard.className = 'company-card';
                                companyCard.innerHTML = `
                                    <h3>${data.nome}</h3>
                                    <p>Setor: ${data.setor}</p>
                                    <p>Média: ${data.media ? data.media.toFixed(1) : '0.0'} estrelas</p>
                                `;
                                listContainer.appendChild(companyCard);
                            });
                        } else {
                            listContainer.innerHTML = '<p>Nenhuma empresa em destaque no momento.</p>';
                        }
                    } catch (err) {
                        console.error('Erro ao carregar empresas:', err);
                    }
                }

                document.addEventListener('DOMContentLoaded', () => {
                    loadFeaturedCompanies();
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            document.getElementById('login-btn').style.display = 'none';
                            document.getElementById('user-avatar').style.display = 'block';
                            // Verificar role do usuário para admin
                            const userDocRef = doc(db, 'usuarios', user.uid);
                            getDoc(userDocRef).then(userSnap => {
                                if (userSnap.exists()) {
                                    const userData = userSnap.data();
                                    if (userData.role === 'admin') {
                                        document.getElementById('admin-link').style.display = 'block';
                                    }
                                }
                            });
                        } else {
                            document.getElementById('login-btn').style.display = 'block';
                            document.getElementById('user-avatar').style.display = 'none';
                            document.getElementById('admin-link').style.display = 'none';
                        }
                    });
                });
            </script>
           <!-- Continua integração Firebase/Firestore -->

            <script type="module">
                import { auth, db } from './firebase-config.js';
                import { collection, getDocs, query, where, orderBy } from 'firebase/firestore';

                // Função de busca inteligente
                async function searchCompanies() {
                    const input = document.getElementById('search-company').value.trim().toLowerCase();
                    const listContainer = document.getElementById('companies-list');
                    listContainer.innerHTML = '<p>Carregando resultados...</p>';

                    try {
                        const companiesRef = collection(db, 'empresas');
                        const snapshot = await getDocs(companiesRef);
                        const results = [];

                        snapshot.forEach(docSnap => {
                            const data = docSnap.data();
                            const nome = data.nome.toLowerCase();
                            const setor = data.setor.toLowerCase();
                            const local = (data.localizacao || '').toLowerCase();

                            if (nome.includes(input) || setor.includes(input) || local.includes(input)) {
                                results.push(data);
                            }
                        });

                        if (results.length > 0) {
                            listContainer.innerHTML = '';
                            results.forEach(data => {
                                const companyCard = document.createElement('div');
                                companyCard.className = 'company-card';
                                companyCard.innerHTML = `
                                    <h3>${data.nome}</h3>
                                    <p>Setor: ${data.setor}</p>
                                    <p>Média: ${data.media ? data.media.toFixed(1) : '0.0'} estrelas</p>
                                `;
                                listContainer.appendChild(companyCard);
                            });
                        } else {
                            listContainer.innerHTML = '<p>Nenhuma empresa encontrada.</p>';
                        }
                    } catch (err) {
                        console.error('Erro ao buscar empresas:', err);
                        listContainer.innerHTML = '<p>Erro ao buscar empresas.</p>';
                    }
                }

                // Filtrar empresas por setor
                async function filterBySector(sectorName) {
                    const listContainer = document.getElementById('companies-list');
                    listContainer.innerHTML = '<p>Carregando empresas...</p>';

                    try {
                        const companiesRef = collection(db, 'empresas');
                        const q = query(companiesRef, where('setor', '==', sectorName));
                        const snapshot = await getDocs(q);

                        if (!snapshot.empty) {
                            listContainer.innerHTML = '';
                            snapshot.forEach(docSnap => {
                                const data = docSnap.data();
                                const companyCard = document.createElement('div');
                                companyCard.className = 'company-card';
                                companyCard.innerHTML = `
                                    <h3>${data.nome}</h3>
                                    <p>Setor: ${data.setor}</p>
                                    <p>Média: ${data.media ? data.media.toFixed(1) : '0.0'} estrelas</p>
                                `;
                                listContainer.appendChild(companyCard);
                            });
                        } else {
                            listContainer.innerHTML = '<p>Nenhuma empresa encontrada neste setor.</p>';
                        }
                    } catch (err) {
                        console.error('Erro ao filtrar empresas:', err);
                        listContainer.innerHTML = '<p>Erro ao filtrar empresas.</p>';
                    }
                }

                // Toggle menu do usuário
                function toggleUserMenu() {
                    const menu = document.getElementById('user-menu');
                    menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
                }

                // Logout seguro
                async function logout() {
                    try {
                        await auth.signOut();
                        showToast('Logout realizado com sucesso!', 'success');
                        location.reload();
                    } catch (err) {
                        console.error('Erro ao deslogar:', err);
                        showToast('Erro ao deslogar.', 'error');
                    }
                }

                // Inicializar animação typing hero
                const typingPhrases = ['o melhor lugar', 'uma empresa confiável', 'uma oportunidade ideal'];
                let typingIndex = 0, charIndex = 0;
                const typingTextEl = document.querySelector('.typing-text');

                function typeText() {
                    if (!typingTextEl) return;
                    typingTextEl.textContent = typingPhrases[typingIndex].substring(0, charIndex + 1);
                    charIndex++;
                    if (charIndex < typingPhrases[typingIndex].length) {
                        setTimeout(typeText, 100);
                    } else {
                        setTimeout(eraseText, 2000);
                    }
                }

                function eraseText() {
                    typingTextEl.textContent = typingPhrases[typingIndex].substring(0, charIndex - 1);
                    charIndex--;
                    if (charIndex > 0) {
                        setTimeout(eraseText, 50);
                    } else {
                        typingIndex = (typingIndex + 1) % typingPhrases.length;
                        setTimeout(typeText, 500);
                    }
                }

                document.addEventListener('DOMContentLoaded', () => {
                    setTimeout(typeText, 1000);
                });
            </script>
            <script type="module">
                import { auth, db } from './firebase-config.js';
                import { collection, getDocs, query, orderBy, doc, getDoc } from 'firebase/firestore';

                // Carregar empresas em destaque no home
                async function loadFeaturedCompanies() {
                    const listContainer = document.getElementById('companies-list');
                    listContainer.innerHTML = '<p>Carregando empresas em destaque...</p>';

                    try {
                        const companiesRef = collection(db, 'empresas');
                        const q = query(companiesRef, orderBy('media', 'desc')); // Ordena pela média das avaliações
                        const snapshot = await getDocs(q);

                        if (!snapshot.empty) {
                            listContainer.innerHTML = '';
                            snapshot.forEach(docSnap => {
                                const data = docSnap.data();
                                const companyCard = document.createElement('div');
                                companyCard.className = 'company-card';
                                companyCard.innerHTML = `
                                    <h3>${data.nome}</h3>
                                    <p>Setor: ${data.setor}</p>
                                    <p>Média: ${data.media ? data.media.toFixed(1) : '0.0'} estrelas</p>
                                    <a href="empresas.html?empresa=${docSnap.id}" class="btn btn-secondary btn-ver-empresa">
                                        <i class="fas fa-eye"></i> Ver Empresa
                                    </a>
                                `;
                                listContainer.appendChild(companyCard);
                            });
                        } else {
                            listContainer.innerHTML = '<p>Nenhuma empresa cadastrada ainda.</p>';
                        }
                    } catch (err) {
                        console.error('Erro ao carregar empresas em destaque:', err);
                        listContainer.innerHTML = '<p>Erro ao carregar empresas.</p>';
                    }
                }

                // Atualizar menu de usuário após login
                auth.onAuthStateChanged(async user => {
                    const loginBtn = document.getElementById('login-btn');
                    const userAvatar = document.getElementById('user-avatar');
                    const adminLink = document.getElementById('admin-link');

                    if (user) {
                        loginBtn.style.display = 'none';
                        userAvatar.style.display = 'block';
                        userAvatar.textContent = user.email.charAt(0).toUpperCase();

                        // Checar role do usuário
                        try {
                            const userDocRef = doc(db, 'usuarios', user.uid);
                            const userDocSnap = await getDoc(userDocRef);
                            const userData = userDocSnap.data();
                            if (userData && userData.role === 'admin') {
                                adminLink.style.display = 'block';
                            } else {
                                adminLink.style.display = 'none';
                            }
                        } catch (err) {
                            console.error('Erro ao buscar role do usuário:', err);
                        }
                    } else {
                        loginBtn.style.display = 'flex';
                        userAvatar.style.display = 'none';
                        adminLink.style.display = 'none';
                    }
                });

                // Inicializar home
                document.addEventListener('DOMContentLoaded', () => {
                    loadFeaturedCompanies();
                });

                // Função para central de denúncias do admin
                async function loadDenuncias() {
                    const denunciasContainer = document.getElementById('denuncias-list');
                    if (!denunciasContainer) return;

                    denunciasContainer.innerHTML = '<p>Carregando denúncias...</p>';
                    try {
                        const denunciasRef = collection(db, 'denuncias');
                        const snapshot = await getDocs(denunciasRef);

                        if (!snapshot.empty) {
                            denunciasContainer.innerHTML = '';
                            snapshot.forEach(docSnap => {
                                const data = docSnap.data();
                                const denunciaCard = document.createElement('div');
                                denunciaCard.className = 'denuncia-card';
                                denunciaCard.innerHTML = `
                                    <h4>${data.titulo}</h4>
                                    <p><strong>Usuário:</strong> ${data.usuarioEmail}</p>
                                    <p><strong>Descrição:</strong> ${data.descricao}</p>
                                    <p><strong>Status:</strong> ${data.status}</p>
                                    <button class="btn btn-primary" onclick="aprovarDenuncia('${docSnap.id}')">
                                        Aprovar
                                    </button>
                                    <button class="btn btn-danger" onclick="rejeitarDenuncia('${docSnap.id}')">
                                        Rejeitar
                                    </button>
                                `;
                                denunciasContainer.appendChild(denunciaCard);
                            });
                        } else {
                            denunciasContainer.innerHTML = '<p>Nenhuma denúncia registrada.</p>';
                        }
                    } catch (err) {
                        console.error('Erro ao carregar denúncias:', err);
                        denunciasContainer.innerHTML = '<p>Erro ao carregar denúncias.</p>';
                    }
                }

                // Funções para aprovar ou rejeitar denúncias
                async function aprovarDenuncia(id) {
                    try {
                        const denunciaRef = doc(db, 'denuncias', id);
                        await denunciaRef.update({ status: 'aprovada' });
                        showToast('Denúncia aprovada!', 'success');
                        loadDenuncias();
                    } catch (err) {
                        console.error('Erro ao aprovar denúncia:', err);
                        showToast('Erro ao aprovar denúncia', 'error');
                    }
                }

                async function rejeitarDenuncia(id) {
                    try {
                        const denunciaRef = doc(db, 'denuncias', id);
                        await denunciaRef.update({ status: 'rejeitada' });
                        showToast('Denúncia rejeitada!', 'success');
                        loadDenuncias();
                    } catch (err) {
                        console.error('Erro ao rejeitar denúncia:', err);
                        showToast('Erro ao rejeitar denúncia', 'error');
                    }
                }
            </script>
        </body>
</html>